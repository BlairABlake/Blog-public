<!doctype html><html><head><meta charset=utf-8><meta name=generator content="Hugo 0.107.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><meta name=keywords content><meta name=description content="The history and architecture of unix"><meta name=author content="Kaga Ryousuke"><meta name=copyright content="Kaga Ryousuke"><meta http-equiv=content-language content="zh,en"><link rel=canonical href=http://blairablakeblog.s3-website-ap-northeast-1.amazonaws.com/c/unix/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>Unix and C&nbsp;&ndash;&nbsp;Blog</title><link rel=preconnect href=https://cdn.jsdelivr.net/ crossorigin><link rel=dns-prefetch href=https://cdn.jsdelivr.net/><link rel=dns-prefetch href=https://fonts.gstatic.com/><link rel=preload href=/css/core.min.7fea1f5a41ad0e665eeb874055b0e68e8a11091c60801d2e241269731df6f3b4cd1871c64da457ede9e3d44dcee5732b.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/css/core.min.7fea1f5a41ad0e665eeb874055b0e68e8a11091c60801d2e241269731df6f3b4cd1871c64da457ede9e3d44dcee5732b.css integrity=sha384-f+ofWkGtDmZe64dAVbDmjooRCRxggB0uJBJpcx3287TNGHHGTaRX7enj1E3O5XMr></noscript><style type=text/css>*,::before,::after{margin:0;padding:0;box-sizing:border-box}html{font-family:-system-ui,-apple-system,BlinkMacSystemFont,helvetica neue,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol;font-size:17px;font-weight:400;line-height:2;scroll-behavior:smooth;transition:color .3s,background-color .3s;word-wrap:break-word;-webkit-text-size-adjust:100%}html[data-theme=dark] img{opacity:.7;transition:opacity .5s ease-in-out}html{background:#fff;--site-name-color:#3f4b67;--color-primary:#005ab4;--link-underline:#90cff9;--blockquote-border-left:6px solid #0051a2;--block-background-color:#f7faff;--pag-background-color:rgba(0, 122, 255, .5);--box-shadow:1px 1px 2px rgba(0,0,0,.125);--title-color:#303033;--body-color:#444}html[data-theme=dark]{background:#22272e;--site-name-color:#539bf5;--color-primary:#99bde1;--link-underline:#0051a2;--blockquote-border-left:6px solid #5176bf;--block-background-color:#002c58;--box-shadow:none;--title-color:#dadada;--body-color:#e9e9e9}h1,h2,h3,h4,h5,h6{font-weight:600;line-height:1;margin-block-start:0;margin-block-end:0}h1{font-size:26px}h2{font-size:24px}h3{font-size:22px}section>h1{color:var(--title-color)}a{color:var(--color-primary);text-decoration-thickness:.2rem;text-decoration-color:var(--link-underline)}a:hover{text-decoration-color:var(--color-primary)}.wrapper{display:grid;grid-template-columns:1fr min(65ch,calc(100% - 64px))1fr;grid-column-gap:32px}.wrapper>section{grid-column:2}.header{margin:20px 0;display:-webkit-flex;display:flex;flex-wrap:wrap;text-align:initial;padding:15px 0;border-bottom:1px solid #f0f0f0;justify-content:space-between;align-items:baseline}.site-name{display:inline-block;font-weight:600;font-size:21px;color:var(--site-name-color)}.site-logo{height:38px;border-radius:3px;vertical-align:middle;margin-right:8px}.nav-item{display:inline-block;font-size:18px;padding:4px 6px;margin:2px 3px 2px 0;line-height:2;white-space:nowrap}.data-theme-btn{border:none;vertical-align:middle;transition:.3s;background-color:Transparent;background-repeat:no-repeat;cursor:pointer;overflow:hidden;outline:none;padding-right:0;padding-left:0}html[data-theme=light] .light-hidden{display:none}html[data-theme=dark] .dark-hidden{display:none}.note-list{margin:0;padding:0;list-style:none}.note-list .item{position:relative;width:100%;margin-top:25px}.note-list .item:last-child{border:0!important}.note-title{font-size:19px;font-weight:700}.note-date,.note-content{font-size:15px;text-decoration:none;color:var(--body-color)}.note-content,.note-imgs,.note-labels{margin-top:4px;text-align:justify;text-justify:inter-word}.article-tag,.article-category{display:inline-block;font-size:15px;line-height:1;padding:4px 6px;margin:2px 3px 2px 0;white-space:nowrap;border-radius:3px}.article-category{color:#3a8c42}.article-category .hashtag,.article-tag .hashtag{font-weight:700;opacity:.5}.footer{font-size:13px;margin:40px 0 20px}.footer-wrap{text-align:center;color:var(--body-color)}.tag-cloud{margin:2em 0 3em;text-align:center}.tag-cloud-tags{display:inline-block;position:relative;margin:5px;word-wrap:break-word;overflow-wrap:break-word}.archive-year{font-size:20px;font-weight:800;color:var(--title-color);margin-top:20px;margin-bottom:10px}.archive-list{list-style:none}.archive-date{flex:0 0 100px;color:var(--title-color)}.archive-text{color:var(--body-color)}ul.archive-list li{display:flex}.article-containter{margin-bottom:20px}.article-header{margin:20px 0}.article-date{font-size:14px;margin-top:20px;color:#838387}.lastmod-date{font-size:14px;color:#838387}.markdown-body{color:var(--body-color)}.markdown-body p{margin-top:0;margin-bottom:20px}.pagination{display:block;text-align:center;margin:20px 0 40px}.pagination ul{display:inline-block;list-style:none;font-weight:600;padding:0;margin:0}.pagination ul li{display:inline}.pagination ul li a{color:var(--color-primary);float:left;padding:8px 16px;text-decoration:none}.pagination ul li a:hover:not(.active){background-color:var(--pag-background-color)}.pagination ul li a.active{background-color:var(--color-primary);color:var(--block-background-color)}</style></head><body><div class=wrapper><section id=header class=header><div class=header-left><a href=/><img class=site-logo src=/images/logo.jpg alt><p class=site-name>Blog</p></a></div><div class=header-right><div class=nav><a class=nav-item href=/>Index</a><a class=nav-item href=/tags/>Tags</a><a class=nav-item href=/archives/>Archives</a><a class=nav-item href=/about/>About</a><script>const htmlEl=document.getElementsByTagName("html")[0],currentTheme=localStorage.getItem("theme")?localStorage.getItem("theme"):null;currentTheme&&(htmlEl.dataset.theme=currentTheme);const toggleTheme=e=>{htmlEl.dataset.theme=e,localStorage.setItem("theme",e)};toggleTheme("light")</script></div></div></section><section id=content><div class=article-containter><section class=article-header><h1>Unix and C</h1><p class=article-date>2023-09-10</p></section><section class=article-labels><a class="article-tag li" href=/tags/programming/><span class=hashtag>#</span>programming</a><a class="article-tag li" href=/tags/unix/><span class=hashtag>#</span>unix</a><a class="article-tag li" href=/tags/c/><span class=hashtag>#</span>c</a></section><article class=markdown-body><h1 id=brief-history>Brief History</h1><h2 id=multics-os-and-unix>Multics OS and Unix</h2><p><a target=_blank rel="noopener noreferrer" href=/images/multics-unix.png><img loading=lazy src=/images/multics-unix.png width=100% height=auto alt=multics-unix></a></p><p><strong>Multics OS brought many revolutionary ideas.</strong></p><table><thead><tr><th>Before</th><th>Multics OS</th><th>After</th></tr></thead><tbody><tr><td>OSs were developed using assembly</td><td>A higher-level programming lanugage <a href=https://en.wikipedia.org/wiki/PL/I target=_blank rel=noopener>PL/1</a> was used</td><td>C was developed and became the de facto standard to develop OSs</td></tr><tr><td>There were no command processor</td><td>Command processor was introduced</td><td>Most OSs today provide command processor.</td></tr><tr><td>There were no hierachical file system</td><td>Hierachical file system was introduced</td><td>Most OSs today employ the hierachical file system</td></tr></tbody></table><h1 id=philosophy-of-unix>Philosophy of Unix</h1><ul><li>Unix is mainly designed and developed to be used by programmers and not ordinary end users.</li><li>Unix is made up of many small and simple programs.</li><li>A complex task can be performed by executing a sequence of these small and simple programs in chain.</li><li>Each small and simple program should be able to pass its output as the input of another program, and this chain should continue.</li><li>Unix is very text-oriented.</li><li>Unix suggests simplicity over perfection</li><li>Program written for certain Unix-compliant operating system should be easily usable in other unix systems.</li></ul><p>Though Unix was appeared as a refinement of Multics OS, both follows the same architecure, the onion architecture.</p><h1 id=onion-architecture>Onion Architecture</h1><p><a target=_blank rel="noopener noreferrer" href=/images/onion-architecture.png><img loading=lazy src=/images/onion-architecture.png width=100% height=auto alt="Onion architecure"></a></p><p>Inner rings provie somee interfaces for the outer ring
The interactions should be restricted to only between neighbourhoods.</p><p><a target=_blank rel="noopener noreferrer" href=/images/onion-interactions.png><img loading=lazy src=/images/onion-interactions.png width=100% height=auto alt="Onion interactions"></a></p><h1 id=terminologies>Terminologies</h1><ul><li>Single Unix Specification (SUS): a standard for OS, which specifies rogramming interfaces for the C language, a command-line shell, and user commands.</li><li>unix-compliant system: a system which is fully compliant to SUS standards</li><li>unix-like system: a system which is compliant to a specific subset of SUS standards</li></ul><h1 id=shell-interface-to-user-applications>Shell Interface to User Applications</h1><p>All unix-like operatin system expose the same API for theri shell ring. The document explaining the exposed interfaces in SUS is <a href=http://www.unix.org/version4/GS5_APIs.pdf target=_blank rel=noopener>here</a>.</p><h1 id=portable-operating-system-interface-posix>Portable Operating System Interface (POSIX)</h1><p>POSIX is a subset of SUS standards that unix-like systems choose to comply with. Most linux distributions are not officially POSIX-compliant, but many of the major ones adhere to POSIX in practice to varying degrees.</p><p><a target=_blank rel="noopener noreferrer" href=/images/posix.png><img loading=lazy src=/images/posix.png width=100% height=auto alt=POSIX></a></p><h1 id=kernel-interface-to-shell-ring>Kernel Interface to Shell Ring</h1><p>Shel ring communicates with Kernel ring through system calls.</p><p>On Unix-like systems, the standard C library or libc is the APIs interfacing between the Kernel and Shell on which a user is running an application.</p><p>A widely used convention for the path of libc are</p><ul><li>/usr/include</li><li>/usr/local/include</li></ul><p>To see the system calls, use truss command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>truss &lt;executable file&gt;
</span></span></code></pre></div><p>To see the manual of system calls, use man command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>man &lt;systemc call&gt;
</span></span></code></pre></div><h1 id=kernel>Kernel</h1><p>A kernel is a process called kernel process, which is fundamentally different from a user process.</p><p>Kernel process is created by copying a kernel image into the main memory by the boot loader. User process is then created using system calls.</p><p>The kernel process see the physical memory and all of the attatched hardware, but a user process sees the virutal memory (process memory) which is mapped to a portion of physical memory.</p><p><a target=_blank rel="noopener noreferrer" href=/images/kernel-process.png><img loading=lazy src=/images/kernel-process.png width=100% height=auto alt="Kernel process"></a></p><h1 id=unix-kernel-responsibilities>Unix Kernel Responsibilities</h1><ul><li>process management</li><li>inter-process communication</li><li>scheduling</li><li>memory management</li><li>system setups</li><li>device management</li></ul><h1 id=hardware>Hardware</h1><h1 id=system-calls-and-kernels>System calls and Kernels</h1><p><a target=_blank rel="noopener noreferrer" href=/images/syscalls-kernel.png><img loading=lazy src=/images/syscalls-kernel.png width=100% height=auto alt="Syscalls and Kernel"></a></p><h1 id=unix-kernels>Unix Kernels</h1><p>The kernels can be classified into two categories,</p><ul><li>Microkernel</li><li>Monolithic kernel</li></ul></article></div><section class=article-navigation><p><a class=link href=/c/c-datastructures/><span class=li></span>Data structures in C</a></p><p><a class=link href=/c/c-fundamentals/><span class=li></span>Fundamentals of C language</a class="link"></p></section></section><section id=footer class="footer max-body-width"><div class=footer-wrap><p class=copyright>Blog</p></div><div class=footer-wrap><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-SA 4.0</a><span> | </span><a href=/index.xml target=_blank rel=noopener>RSS</a></div><div class=footer-wrap><p class=powerby><span>Powered by </span><a href=https://gohugo.io target=_blank rel=noopener>Hugo</a><span> and the </span><a href=https://github.com/qdzhang/hugo-notepadium-mod target=_blank rel=noopener>Notepadium-mod</a></p></div><div class=footer-wrap><a onclick='window.scrollTo({top:0,behavior:"smooth"})'>^ TOP ^</a></div></section><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script></div></body></html>